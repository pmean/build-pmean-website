---
title: "Add headers to md files"
author: "Steve Simon"
date: "6/28/2019"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo=FALSE)
source(file="prelims.R", echo=FALSE)
verbose <- TRUE
```

```{r list-dirs}
b2_path <- "c:/web/b2"
b3_path <- "c:/web/b3"
b2_names <- list.files(b2_path)
if (verbose) print(b2_names)
n_files <- length(b2_names)
```

```{r read-bib}
bib_path <- "c:/web/r1/19/06"
bib_files <- list.files(path=bib_path, pattern="*.bib")
bib_count <- length(bib_files)
txt_original <- as.list(1:bib_count)
bib_dates <- rep("1999-09-09", bib_count)
bib_tags <- rep("Untagged", bib_count)
bib_titles <- rep("No title", bib_count)
bib_note <- rep("No commentary.", bib_count)
yaml_divider <- '---'
for (i_file in 1:bib_count) {
  txt_original[[i_file]] <- readLines(paste0(bib_path, "/", bib_files[i_file]))
  b <- select_txt(txt_original[[i_file]], "urldate = ")
  if (length(b)==1) {bib_dates[i_file] <- b}
  b <- select_txt(txt_original[[i_file]], "mendeley-tags = ")
  if (length(b)==1) {bib_tags[i_file] <- b}
  b <- select_txt(txt_original[[i_file]], "title = ")
  if (length(b)==1) {bib_titles[i_file] <- b}
  b <- select_txt(txt_original[[i_file]], "annote = ")
  if (length(b)==1) {bib_note[i_file] <- b}
  yaml_divider %>%
    add_line_breaks %>%
    paste0('title: ') %>%
    add_quoted_string(bib_titles[i_file]) %>%
    add_line_breaks %>%
    paste0('date: ') %>%
    add_quoted_string(bib_dates[i_file]) %>%
    add_line_breaks %>%
    paste0("tags: ") %>%
    add_quoted_string(bib_tags[i_file]) %>%
    add_line_breaks %>%
    paste0('output: html_document') %>%
    add_line_breaks %>%
    paste0(yaml_divider) %>%
    add_line_breaks(2)  %>%
    paste0(bib_note[i_file])  %>%
    add_line_breaks(2) -> yaml_header
  if (verbose) {
    cat(bib_files[i_file])
    cat("\n")
    cat(yaml_header)  
  }
}
o <- rev(order(bib_dates))
bib_dates <- bib_dates[o]
bib_files <- bib_files[o]
txt_full <- as.list(1:bib_count)
for (i in 1:bib_count) {
  txt_full[[i]] <- txt_original[[o[i]]]
}
```

Save everything.

```{r save-everything}
save.image("../data/create-b3.RData")
```